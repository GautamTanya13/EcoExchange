{% extends 'product/base.html' %}
{% load static %}
{% block body %}
<div class="row">
    <div class="col-lg-3 bg-primary rounded div-space">
        <h4>Don't let it sit around! Sell it here for something else!</h4>
        <form class="py-4" method="post" enctype="multipart/form-data" action="{% url 'product_details' %}">
            {% csrf_token %}
            {{ form.as_p }}
            <div class="px-8 py-8">
                <button class="btn btn-dark border-0 p-lg-10" type="submit">Submit</button>
            </div>
        </form>
        {% if messages %}
            <div class="messages">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
    <div class="col-lg-9">
        <div class="row">
            {% for product in products %}
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card">
                        <img class="card-img-top img-fluid rounded image-div" src="{{ product.image.url }}" alt="{{ product.product_name }}">
                        <div class="card-body">
                            <h5 class="card-title">{{ product.product_name }}</h5>
                            <p class="card-text">{{ product.product_description }}</p>
                            <p class="card-text">Quantity: {{ product.quantity }}</p>
                            <p class="card-text">Coins: {{ product.price }}</p>
                            <div class="button-display">
                                <button class="btn btn-primary mt-3" onclick="editProduct('{{ product.product_id }}', '{{ product.product_name }}', '{{ product.product_description }}', '{{ product.quantity }}', '{{ product.price }}', '{{ product.image }}', '{{ product.category }}')">Edit</button>
                                <form action="{% url 'product_delete' product.product_id %}" method="POST">
                                    {% csrf_token %}
                                    <button class="btn btn-danger mt-3">Delete</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>

<div class="modal fade" id="editProductModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editProductModalLabel">Edit Product</h5>
            </div>
            <div class="modal-body">
                <form id="editProductForm" enctype="multipart/form-data" method="POST" action="{% url 'product_update' %}">
                    {% csrf_token %}
                    <input type="hidden" id="productId" name="product_id" value="{{ product.product_id }}">
                    <div class="form-group">
                        <label for="productName">Product Name</label>
                        <input type="text" class="form-control" id="productName" name="product_name" required>
                    </div>
                    <div class="form-group">
                        <label for="productDescription">Product Description</label>
                        <textarea class="form-control" id="productDescription" name="product_description" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="categoryName">Category</label>
                        <select class="form-control" id="productCategory" name="category" required>
                            {% for category in categories %}
                                <option value="{{ category }}">{{ category }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="productQuantity">Quantity</label>
                        <input type="number" class="form-control" id="productQuantity" name="quantity" required>
                    </div>
                    <div class="form-group">
                        <label for="productPrice">Coins</label>
                        <input type="text" class="form-control" id="productPrice" name="price" required>
                    </div>
                    <div class="form-group">
                        <label for="productImage">Image</label>
                        <input type="file" class="form-control" id="productImage" name="image" accept="image/*" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
